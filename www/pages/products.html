<div class="page" data-name="products">
  <div class="navbar">
    <div class="navbar-inner">
      <div class="left">
        <a href="#" class="link panel-open" data-panel="left">
          <i class="icon material-icons">menu</i>
        </a>
      </div>
      <div class="title">Productos</div>
      <div class="right">
        <a href="#" class="link" id="info-button-product">
          <i class="icon material-icons">info</i>
        </a>
        <a href="/" class="link">
          <i class="icon material-icons">home</i>
        </a>
      </div>
    </div>
  </div>

  <div class="page-content" style="background-color: #f5f7fa;">
    <!-- Estados -->
    <div id="loading-state-products" class="block block-strong text-align-center" style="display: none;">
      <div class="preloader"></div>
      <p>Cargando productos...</p>
    </div>

    <div id="empty-state-products" class="block block-strong text-align-center" style="display: none;">
      <i class="icon material-icons" style="font-size: 48px; color: #ccc;">inventory_2</i>
      <p>No hay productos disponibles</p>
      <a href="#" class="button button-fill button-round" id="add-product-btn"
        style="background-color: #00bcd4; color: white;">
        <i class="icon material-icons">add</i> Agregar producto
      </a>
    </div>

    <!-- Contenedor principal de productos (barra de búsqueda + lista) -->
    <div id="products-container" style="display: none;">
      <!-- Barra de búsqueda -->
      <div class="block" style="margin-top: 0; padding-top: 16px;">
        <div class="searchbar searchbar-init">
          <div class="searchbar-inner">
            <div class="searchbar-input-wrap">
              <input type="search" placeholder="Buscar productos" id="search-input">
              <i class="searchbar-icon"></i>
              <span class="input-clear-button"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de productos -->
      <div class="block"
        style="margin: 16px; padding: 0; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <div class="list media-list" style="margin: 0; max-height: calc(100vh - 200px); overflow-y: auto;">
          <ul id="products-list" style="background-color: white;"></ul>
        </div>
      </div>
    </div>

    <!-- Botón flotante para agregar -->
    <div class="fab fab-right-bottom">
      <a href="#" class="button button-fill button-round popup-open" id="add-product-fab"
        style="background-color: #00bcd4; color: white;">
        <i class="icon material-icons">add</i>
      </a>
    </div>
  </div>

  <!-- Popup para formulario de producto -->
  <div class="popup product-popup">
    <div class="view">
      <div class="page">
        <div class="navbar">
          <div class="navbar-inner">
            <div class="left">
              <a href="#" class="link popup-close">
                <i class="icon material-icons">close</i>
              </a>
            </div>
            <div class="title" id="popup-title-product">Nuevo Producto</div>
          </div>
        </div>
        <div class="page-content">
          <div class="block">
            <!-- Vista previa de imagen -->
            <div class="text-align-center" style="margin-bottom: 16px;">
              <img id="image-preview" src="../assets/images/no-image-icon.png"
                style="width: 120px; height: 120px; border-radius: 8px; object-fit: cover;">
              <input type="hidden" id="image-path">
            </div>
            <button type="button" class="button button-outline button-round" id="select-image-btn">
              <i class="icon material-icons">image</i> Seleccionar imagen
            </button>
          </div>

          <div class="list">
            <ul>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Nombre*</div>
                  <div class="item-input-wrap">
                    <input type="text" id="product-name" placeholder="Nombre del producto">
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Descripción</div>
                  <div class="item-input-wrap">
                    <input type="text" id="product-description" placeholder="Descripción del producto">
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Precio compra*</div>
                  <div class="item-input-wrap">
                    <input type="number" step="0.01" id="product-purchase-price" placeholder="0.00">
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Precio venta*</div>
                  <div class="item-input-wrap">
                    <input type="number" step="0.01" id="product-sale-price" placeholder="0.00">
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Stock</div>
                  <div class="item-input-wrap">
                    <input type="number" step="0.01" id="product-stock" placeholder="0">
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Tipo unidad*</div>
                  <div class="item-input-wrap">
                    <select id="product-unit-type">
                      <option value="unidad">Unidad</option>
                      <option value="libra">Libra</option>
                      <option value="kg">Kilogramo</option>
                      <option value="litro">Litro</option>
                      <option value="paquete">Paquete</option>
                    </select>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Categoría*</div>
                  <div class="item-input-wrap">
                    <select id="product-category">
                      <option value="" disabled selected>Seleccione una categoría</option>
                      <!-- Se llenará dinámicamente -->
                    </select>
                  </div>
                </div>
              </li>
              <li class="item-content item-input">
                <div class="item-inner">
                  <div class="item-title item-label">Código de barras</div>
                  <div class="item-input-wrap">
                    <input type="text" id="barcode" placeholder="Opcional">
                  </div>
                </div>
              </li>
            </ul>
          </div>

          <div class="block">
            <input type="hidden" id="product-id">
            <button type="button" class="button button-fill button-round color-blue" id="save-product-btn">
              Guardar
            </button>
            <div id="delete-btn-container-products" style="display: none; margin-top: 10px;">
              <button type="button" class="button button-fill button-round color-red" id="delete-product-btn">
                Eliminar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="popup info-popup-product popup-swipe-to-close">
    <div class="view">
      <div class="page">
        <div class="navbar">
          <div class="navbar-inner">
            <div class="left">
              <a href="#" class="link popup-close">
                <i class="icon material-icons">close</i>
              </a>
            </div>
            <div class="title" id="info-title-product">Guía de Productos</div>
          </div>
        </div>
        <div class="page-content">
          <!-- Introducción -->
          <div class="card info-card animate__animated animate__fadeInUp"
            style="margin: 16px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,188,212,0.2);">
            <div class="card-header"
              style="background-color: #00bcd4; color: white; font-weight: 500; padding: 12px 16px;">
              <div style="display: flex; align-items: center; gap: 8px; line-height: 1;">
                <i class="icon material-icons"
                  style="font-size: 20px; display: inline-flex; align-items: center; justify-content: center;">help_outline</i>
                <span style="display: inline-flex; align-items: center;">¿Qué son los productos?</span>
              </div>
            </div>
            <div class="card-content card-content-padding" style="padding: 16px;">
              <p style="margin: 0; color: #555; line-height: 1.5;">
                Los productos son los artículos que vendes en tu negocio. Cada producto debe estar correctamente
                configurado con precios, stock y categoría para un control de inventario preciso.
              </p>
            </div>
          </div>

          <!-- Sección de campos obligatorios -->
          <div class="block animate__animated animate__fadeInUp animate__delay-1s" style="margin-top: 24px;">
            <h3
              style="color: #00bcd4; margin: 0 0 12px 16px; font-size: 18px; display: flex; align-items: center; gap: 8px;">
              <i class="icon material-icons">error_outline</i>
              <span>Campos obligatorios</span>
            </h3>
            <div class="list accordion-list" style="margin: 0; border-radius: 12px; overflow: hidden;">
              <ul>
                <li class="accordion-item animate__animated animate__fadeIn" style="animation-delay: 0.1s;">
                  <a href="#" class="item-link item-content" style="padding-left: 16px;">
                    <div class="item-inner">
                      <div class="item-title" style="display: flex; align-items: center; gap: 8px;">
                        <i class="icon material-icons" style="color: #00bcd4;">title</i>
                        <span>Nombre del producto</span>
                      </div>
                    </div>
                  </a>
                  <div class="accordion-item-content">
                    <div class="block" style="padding: 12px 16px 12px 56px; background-color: #f5f5f5;">
                      <p style="margin: 0 0 8px 0;">Debe ser descriptivo pero conciso (2-50 caracteres).</p>
                      <p style="margin: 0; color: #ff5252; font-weight: 500;">Ejemplo incorrecto: "Producto 1"</p>
                      <p style="margin: 8px 0 0 0; color: #4caf50; font-weight: 500;">Ejemplo correcto: "Arroz Integral
                        1kg"</p>
                    </div>
                  </div>
                </li>
                <li class="accordion-item animate__animated animate__fadeIn" style="animation-delay: 0.2s;">
                  <a href="#" class="item-link item-content" style="padding-left: 16px;">
                    <div class="item-inner">
                      <div class="item-title" style="display: flex; align-items: center; gap: 8px;">
                        <i class="icon material-icons" style="color: #00bcd4;">attach_money</i>
                        <span>Precios</span>
                      </div>
                    </div>
                  </a>
                  <div class="accordion-item-content">
                    <div class="block" style="padding: 12px 16px 12px 56px; background-color: #f5f5f5;">
                      <p style="margin: 0 0 8px 0;"><strong>Precio de compra:</strong> Lo que te cuesta adquirir el
                        producto.</p>
                      <p style="margin: 0 0 8px 0;"><strong>Precio de venta:</strong> Lo que cobrarás a tus clientes.
                      </p>
                      <p style="margin: 0; color: #ff5252; font-weight: 500;">El precio de venta DEBE ser mayor que el
                        de compra (mínimo 5% de margen).</p>
                    </div>
                  </div>
                </li>
                <li class="accordion-item animate__animated animate__fadeIn" style="animation-delay: 0.3s;">
                  <a href="#" class="item-link item-content" style="padding-left: 16px;">
                    <div class="item-inner">
                      <div class="item-title" style="display: flex; align-items: center; gap: 8px;">
                        <i class="icon material-icons" style="color: #00bcd4;">description</i>
                        <span>Descripción</span>
                      </div>
                    </div>
                  </a>
                  <div class="accordion-item-content">
                    <div class="block" style="padding: 12px 16px 12px 56px; background-color: #f5f5f5;">
                      <p style="margin: 0 0 8px 0;">Añade detalles que ayuden a identificar el producto:</p>
                      <ul style="margin: 8px 0 0 16px; padding: 0; list-style-type: disc;">
                        <li>Marca</li>
                        <li>Características especiales</li>
                        <li>Presentación</li>
                        <li>Variantes</li>
                      </ul>
                      <p style="margin: 8px 0 0 0; color: #ff5252; font-weight: 500;">Este campo es obligatorio para una
                        mejor gestión.</p>
                    </div>
                  </div>
                </li>
                <li class="accordion-item animate__animated animate__fadeIn" style="animation-delay: 0.4s;">
                  <a href="#" class="item-link item-content" style="padding-left: 16px;">
                    <div class="item-inner">
                      <div class="item-title" style="display: flex; align-items: center; gap: 8px;">
                        <i class="icon material-icons" style="color: #00bcd4;">category</i>
                        <span>Categoría</span>
                      </div>
                    </div>
                  </a>
                  <div class="accordion-item-content">
                    <div class="block" style="padding: 12px 16px 12px 56px; background-color: #f5f5f5;">
                      <p style="margin: 0 0 8px 0;">Todos los productos deben pertenecer a una categoría.</p>
                      <p style="margin: 0; color: #ff5252; font-weight: 500;">Si no ves categorías disponibles, debes
                        crearlas primero en la sección de Categorías.</p>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <!-- Sección de campos opcionales -->
          <div class="block animate__animated animate__fadeInUp animate__delay-2s" style="margin-top: 24px;">
            <h3
              style="color: #00bcd4; margin: 0 0 12px 16px; font-size: 18px; display: flex; align-items: center; gap: 8px;">
              <i class="icon material-icons">check_box_outline_blank</i>
              <span>Campos opcionales</span>
            </h3>
            <div class="list accordion-list" style="margin: 0; border-radius: 12px; overflow: hidden;">
              <ul>
                <li class="accordion-item animate__animated animate__fadeIn" style="animation-delay: 0.1s;">
                  <a href="#" class="item-link item-content" style="padding-left: 16px;">
                    <div class="item-inner">
                      <div class="item-title" style="display: flex; align-items: center; gap: 8px;">
                        <i class="icon material-icons" style="color: #00bcd4;">photo_camera</i>
                        <span>Imagen</span>
                      </div>
                    </div>
                  </a>
                  <div class="accordion-item-content">
                    <div class="block" style="padding: 12px 16px 12px 56px; background-color: #f5f5f5;">
                      <p style="margin: 0 0 8px 0;">Una imagen ayuda a identificar rápidamente el producto.</p>
                      <p style="margin: 0; color: #4caf50; font-weight: 500;">Recomendación: Usa fotos con fondo blanco
                        y buena iluminación.</p>
                    </div>
                  </div>
                </li>
                <li class="accordion-item animate__animated animate__fadeIn" style="animation-delay: 0.2s;">
                  <a href="#" class="item-link item-content" style="padding-left: 16px;">
                    <div class="item-inner">
                      <div class="item-title" style="display: flex; align-items: center; gap: 8px;">
                        <i class="icon material-icons"
                          style="color: #00bcd4; font-size: 24px; line-height: 1;">confirmation_number</i>
                        <span>Código de barras</span>
                      </div>
                    </div>
                  </a>
                  <div class="accordion-item-content">
                    <div class="block" style="padding: 12px 16px 12px 56px; background-color: #f5f5f5;">
                      <p style="margin: 0 0 8px 0; display: flex; align-items: flex-start;">
                        <i class="icon material-icons"
                          style="color: #00bcd4; font-size: 20px; margin-right: 8px; margin-top: 2px;">confirmation_number</i>
                        <span>Si el producto tiene código de barras, escanéalo o ingrésalo manualmente.</span>
                      </p>
                      <p style="margin: 8px 0 8px 28px; color: #4caf50; font-weight: 500;">
                        Esto agilizará las ventas y el control de inventario.
                      </p>
                      <p style="margin: 8px 0 0 28px; font-size: 13px; color: #666;">
                        Este campo es completamente opcional.
                      </p>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <!-- Sección de buenas prácticas -->
          <div class="block animate__animated animate__fadeInUp animate__delay-3s"
            style="margin-top: 24px; margin-bottom: 24px;">
            <h3
              style="color: #00bcd4; margin: 0 0 12px 16px; font-size: 18px; display: flex; align-items: center; gap: 8px;">
              <i class="icon material-icons">lightbulb_outline</i>
              <span>Buenas prácticas</span>
            </h3>
            <div class="list" style="margin: 0; border-radius: 12px; overflow: hidden;">
              <ul>
                <li class="item-content tip-item animate__animated animate__fadeIn"
                  style="padding: 16px; animation-delay: 0.1s;">
                  <div class="item-inner" style="display: flex; align-items: flex-start;">
                    <!-- Cambiado a flex-start -->
                    <i class="icon material-icons"
                      style="color: #4caf50; margin-right: 12px; flex-shrink: 0;">check_circle</i> <!-- Icono fijo -->
                    <div class="item-title"
                      style="font-size: 14px; line-height: 1.5; white-space: normal; word-wrap: break-word;">
                      Actualiza el stock regularmente para mantener un inventario preciso y evitar faltantes o excesos
                      en tus productos más vendidos.
                    </div>
                  </div>
                </li>
                <li class="item-content tip-item animate__animated animate__fadeIn"
                  style="padding: 16px; animation-delay: 0.2s;">
                  <div class="item-inner" style="display: flex; align-items: flex-start;">
                    <i class="icon material-icons"
                      style="color: #4caf50; margin-right: 12px; flex-shrink: 0;">check_circle</i>
                    <div class="item-title" style="font-size: 14px; line-height: 1.5; white-space: normal;">
                      Usa categorías específicas (ej. "Lácteos/Refrigerados" en lugar de "Varios") para facilitar la
                      búsqueda y reportes.
                    </div>
                  </div>
                </li>
                <li class="item-content tip-item animate__animated animate__fadeIn"
                  style="padding: 16px; animation-delay: 0.3s;">
                  <div class="item-inner" style="display: flex; align-items: flex-start;">
                    <i class="icon material-icons"
                      style="color: #ff5252; margin-right: 12px; flex-shrink: 0;">warning</i>
                    <div class="item-title" style="font-size: 14px; line-height: 1.5; white-space: normal;">
                      No elimines productos con historial de ventas (mejor desactívalos) para mantener la integridad de
                      tus reportes históricos.
                    </div>
                  </div>
                </li>
                <li class="item-content tip-item animate__animated animate__fadeIn"
                  style="padding: 16px; animation-delay: 0.4s;">
                  <div class="item-inner" style="display: flex; align-items: flex-start;">
                    <i class="icon material-icons"
                      style="color: #4caf50; margin-right: 12px; flex-shrink: 0;">check_circle</i>
                    <div class="item-title" style="font-size: 14px; line-height: 1.5; white-space: normal;">
                      Revisa los márgenes de ganancia periódicamente (al menos mensual) para mantener la rentabilidad de
                      tu negocio.
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <!-- Ejemplo de producto bien configurado -->
          <div class="block animate__animated animate__fadeInUp animate__delay-4s" style="margin-top: 24px;">
            <h3
              style="color: #00bcd4; margin: 0 0 12px 16px; font-size: 18px; display: flex; align-items: center; gap: 8px;">
              <i class="icon material-icons">star</i>
              <span>Ejemplo completo</span>
            </h3>
            <div class="card example-card animate__animated animate__pulse animate__delay-5s"
              style="margin: 0 16px 24px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,188,212,0.2);">
              <div class="card-content card-content-padding" style="padding: 16px;">
                <div style="display: flex; margin-bottom: 12px;">
                  <img src="../assets/images/product-example.jpg"
                    style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover; margin-right: 12px;">
                  <div>
                    <p style="font-weight: 500; margin: 0 0 4px 0; color: #333;">Leche Entera 1L</p>
                    <p style="font-size: 13px; margin: 0 0 4px 0; color: #666;">Marca XYZ, pasteurizada, caja</p>
                    <p style="font-size: 14px; margin: 0; color: #00bcd4; font-weight: bold;">$2.50</p>
                  </div>
                </div>

                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                  <span
                    style="background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                    <i class="icon material-icons"
                      style="font-size: 12px; margin-right: 4px; vertical-align: middle;">category</i>
                    Lácteos
                  </span>
                  <span
                    style="background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                    <i class="icon material-icons"
                      style="font-size: 12px; margin-right: 4px; vertical-align: middle;">inventory</i>
                    Stock: 25
                  </span>
                  <span
                    style="background: #fff3e0; color: #e65100; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                    <i class="icon material-icons"
                      style="font-size: 12px; margin-right: 4px; vertical-align: middle;">local_offer</i>
                    Margen: 30%
                  </span>
                </div>

                <div style="margin-top: 12px; display: flex; justify-content: space-between;">
                  <span style="font-size: 12px; color: #666;">
                    <i class="icon material-icons"
                      style="font-size: 12px; margin-right: 4px; vertical-align: middle;">confirmation_number</i>
                    1234567890123 (opcional)
                  </span>
                  <span style="font-size: 12px; color: #666;">
                    <i class="icon material-icons"
                      style="font-size: 12px; margin-right: 4px; vertical-align: middle;">scale</i>
                    Unidad
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>